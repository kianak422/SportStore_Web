@page "/checkout-invoice"
@using SportStore.Client.Data
@inject CartService CartService
@inject NavigationManager NavigationManager // C·∫ßn ƒë·ªÉ chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng

<main class="page-content active max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h2 class="text-4xl font-extrabold text-gray-900 mb-8 border-b-4 border-lime-600 pb-2">
        X√°c Nh·∫≠n Thanh To√°n
    </h2>

    @if (IsOrderConfirmed)
    {
        <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-6 rounded-lg shadow-md" role="alert">
            <h3 class="font-bold text-2xl mb-2">üéâ ƒê·∫∂T H√ÄNG TH√ÄNH C√îNG!</h3>
            <p class="text-lg">C·∫£m ∆°n b·∫°n ƒë√£ mua h√†ng t·∫°i SportStore. ƒê∆°n h√†ng c·ªßa b·∫°n ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω.</p>
            <p class="mt-4 font-semibold">M√£ ƒë∆°n h√†ng t·∫°m th·ªùi: #BLAZOR@(DateTime.Now.Ticks.ToString().Substring(10))</p>
            
            <button @onclick="GoHome" class="mt-6 bg-blue-600 text-white py-2 px-4 rounded-lg font-bold hover:bg-blue-700 transition duration-150">
                Ti·∫øp T·ª•c Mua S·∫Øm
            </button>
        </div>
    }
    else
    {
        <div class="max-w-xl mx-auto bg-white p-8 rounded-xl shadow-2xl">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">Th√¥ng Tin H√≥a ƒê∆°n</h3>

            <div class="space-y-4 border-b pb-4">
                <div class="flex justify-between">
                    <span class="text-gray-600">T·ªïng s·ªë l∆∞·ª£ng s·∫£n ph·∫©m:</span>
                    <span class="font-semibold text-lg">@CartService.TotalItemCount</span>
                </div>
                
                @* L·∫∑p qua danh s√°ch item trong gi·ªè h√†ng *@
                @foreach(var item in CartService.Items)
                {
                    <div class="flex justify-between text-sm text-gray-500 ml-4">
                        <span>@item.Name x @item.Quantity</span>
                        <span>@item.TotalFormatted</span>
                    </div>
                }
            </div>

            <div class="flex justify-between text-2xl font-extrabold mt-4 pt-4 border-t-2 border-dashed border-gray-300">
                <span>T·ªîNG C·ªòNG:</span>
                <span class="text-red-600">@($"{(CartService.TotalAmount):N0} VNƒê")</span>
            </div>

            <button @onclick="ConfirmOrder" 
                    disabled="@(CartService.TotalItemCount == 0)"
                    class="w-full mt-8 bg-lime-600 text-white py-3 rounded-lg font-bold text-xl hover:bg-lime-700 transition duration-150 disabled:bg-gray-400">
                HO√ÄN T·∫§T MUA H√ÄNG
            </button>
            <p class="text-sm text-center text-gray-500 mt-2">B·∫±ng c√°ch nh·∫•n n√∫t, b·∫°n ƒë·ªìng √Ω thanh to√°n cho ƒë∆°n h√†ng n√†y.</p>
        </div>
    }
</main>

@code {
    private bool IsOrderConfirmed = false;

    // H√†m n√†y m√¥ ph·ªèng qu√° tr√¨nh x·ª≠ l√Ω thanh to√°n
    private void ConfirmOrder()
    {
        if (CartService.TotalItemCount > 0)
        {
            // B∆∞·ªõc 1: ƒê√°nh d·∫•u ƒë√£ x√°c nh·∫≠n
            IsOrderConfirmed = true;
            
            // B∆∞·ªõc 2: X√≥a gi·ªè h√†ng sau khi thanh to√°n th√†nh c√¥ng
            CartService.ClearCart();
        }
    }

    // H√†m chuy·ªÉn h∆∞·ªõng v·ªÅ Trang Ch·ªß
    private void GoHome()
    {
        NavigationManager.NavigateTo("/");
    }
}